<!DOCTYPE htlml>
<html lang="cs">
<meta charset="UTF-8">
<title>
    Genesis resources users dashboard
</title>
<style>
    table {
        border-collapse: collapse; /* Ensures borders are merged */
        width: 100%; /* Full width */
    }
    th, td {
        border: 1px solid black;
        padding: 10px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
</style>
<script type="text/javascript">

    async function getResponse() {
        var url = "http://localhost:8080/api/v1/users";
        fetch(url,
            {method: "GET"})
            .then(response => response.json())
            .then(data => {
                console.log(data);
                document.getElementById("users").innerHTML = "";
                const tab = document.createElement("table");
                const headerRow = document.createElement('tr');
                //const headers = ['ID', 'Jméno', 'Příjmení'];
                Object.keys(data[0]).forEach(headerText => {
                    const header = document.createElement('th');
                    header.textContent = headerText;
                    headerRow.appendChild(header);
                });
                tab.appendChild(headerRow);

                data.forEach(object => {
                    const row = document.createElement("tr");

                    Object.values(object).forEach(cellData => {
                        const cell = document.createElement('td');
                        cell.textContent = cellData;
                        row.appendChild(cell);
                    });
                    tab.appendChild(row);
                });
                document.getElementById("users").appendChild(tab);

            });
    }
    async function getResponseFull() {
        var url = "http://localhost:8080/api/v1/users?detail=true";
        fetch(url,
            {method: "GET"})
            .then(response => response.json())
            .then(data => {
                console.log(data);
                document.getElementById("users").innerHTML = "";
                const tab = document.createElement("table");
                const headerRow = document.createElement('tr');
                //const headers = ['ID', 'Jméno', 'Příjmení'];
                Object.keys(data[0]).forEach(headerText => {
                    const header = document.createElement('th');
                    header.textContent = headerText;
                    headerRow.appendChild(header);
                });
                tab.appendChild(headerRow);

                data.forEach(object => {
                    const row = document.createElement("tr");

                    Object.values(object).forEach(cellData => {
                        const cell = document.createElement('td');
                        cell.textContent = cellData;
                        row.appendChild(cell);
                    });
                    tab.appendChild(row);
                });
                document.getElementById("users").appendChild(tab);

            });
    }


    async function newUser() {
        const name = document.createElement('input');
        name.type = 'text';
        //name.textContent = 'Jméno:';
        name.placeholder = 'Jméno';
        name.id = 'name';
        name.name = 'name';


        const surname = document.createElement('input');
        surname.type = 'text';
        surname.placeholder = 'Příjmení';
        //surname.textContent = 'Příjmení:';
        surname.id = 'surname';
        surname.name = 'surname';
        //surname.value = 'surname';

        const personId = document.createElement('input');
        personId.type = 'text';
        personId.placeholder = 'Personal ID';
        //personId.textContent = 'Personal ID:';
        personId.id = 'personId';
        personId.name = 'personId';
        //personId.value = 'personId'; Set an ID for reference

        const inputbutton = document.createElement('button');
        inputbutton.type = 'submit';
        inputbutton.placeholder = 'Ulož';
        // inputbutton.value = 'Ulož'; // Add placeholder
        inputbutton.title = "Ulož";
        inputbutton.textContent = 'Ulož';
        //inputbutton.onclick = readForm(); // Add placeholder

        document.getElementById("newUser").innerHTML = "";
        const form = document.createElement('form');
        form.appendChild(name);
        form.appendChild(surname);
        form.appendChild(personId);
        form.appendChild(inputbutton);


        form.addEventListener('submit', function (event) {
            event.preventDefault();


            const formData = new FormData(form);

            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            console.log('Form Data Submitted:', data);

            const jsonData = JSON.stringify(data);
            const apiUrl = 'http://localhost:8080/api/v1/users';

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
                .then(response => {
                    return response.text(); // Return response as text
                })
                .then(message => {
                    // Display response in the modal
                    document.getElementById('modalMessage').textContent = message;
                    document.getElementById('myModal').style.display = "block"; // Show the modal
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('modalMessage').textContent = 'An error occurred: ' + error.message;
                    document.getElementById('myModal').style.display = "block"; // Show the modal
                });
        });
        document.getElementById("newUser").appendChild(form);
    }

    function updateUser() {
        const name = document.createElement('input');
        name.type = 'text';
        //name.textContent = 'Jméno:';
        name.placeholder = 'Jméno';
        name.id = 'name';
        name.name = 'name';


        const surname = document.createElement('input');
        surname.type = 'text';
        surname.placeholder = 'Příjmení';
        //surname.textContent = 'Příjmení:';
        surname.id = 'surname';
        surname.name = 'surname';


        const id = document.createElement('input');
        id.type = 'text';
        id.placeholder = 'ID Uživatele';
        // id.textContent = 'ID Uživatele:';
        id.id = 'id';
        id.name = 'id';


        const inputbutton = document.createElement('button');
        inputbutton.type = 'submit';
        inputbutton.placeholder = 'Ulož';
        // inputbutton.value = 'Ulož'; // Add placeholder
        inputbutton.title = "Ulož";
        inputbutton.textContent = 'Ulož';


        document.getElementById("updateUser").innerHTML = "";
        const form = document.createElement('form');
        form.appendChild(name);
        form.appendChild(surname);
        form.appendChild(id);
        form.appendChild(inputbutton);

        form.addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = new FormData(form);

            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            console.log('Form Data Submitted:', data);

            const jsonData = JSON.stringify(data);
            const apiUrl = 'http://localhost:8080/api/v1/users' ;

            fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
                .then(response => {

                    return response.text(); // Return response as text
                })
                .then(message => {
                    // Display response in the modal
                    document.getElementById('modalMessage').textContent = message;
                    document.getElementById('myModal').style.display = "block"; // Show the modal
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('modalMessage').textContent = 'An error occurred: ' + error.message;
                    document.getElementById('myModal').style.display = "block"; // Show the modal
                });

        });
        document.getElementById("updateUser").appendChild(form);

    }
    function deleteUser() {

        const id = document.createElement('input');
        id.type = 'text';
        id.placeholder = 'ID Uživatele';
        //id.textContent = 'ID Uživatele:';
        id.id = 'id';
        id.name = 'id';

        const inputbutton = document.createElement('button');
        inputbutton.type = 'submit';
        inputbutton.placeholder = 'Ulož';
        inputbutton.title = "Ulož";
        inputbutton.textContent = 'Ulož';

        document.getElementById("deleteUser").innerHTML = "";
        const form = document.createElement('form');

        form.appendChild(id);
        form.appendChild(inputbutton);

        form.addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = new FormData(form);

            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            console.log('Form Data Submitted:', data);

            const jsonData = JSON.stringify(data);
            const apiUrl = 'http://localhost:8080/api/v1/users/' + id.value;

            fetch(apiUrl, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
                .then(response => {
                    return response.text(); // Return response as text
                })
                .then(message => {
                    // Display response in the modal
                    document.getElementById('modalMessage').textContent = message;
                    document.getElementById('myModal').style.display = "block"; // Show the modal
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('modalMessage').textContent = 'An error occurred: ' + error.message;
                    document.getElementById('myModal').style.display = "block"; // Show the modal
                });
        });
        document.getElementById("deleteUser").appendChild(form);

    }
</script>

<body>

<input onclick="getResponse()" type="button" value="Načíst data">

<input onclick="getResponseFull()" type="button" value="Načíst data - celá">

<input onclick="newUser()" type="button" value="Nový uživatel">

<input onclick="updateUser()" type="button" value="Uprav uživatele">

<input onclick="deleteUser()" type="button" value="Smaž uživatele">

<div id="users"></div>

<div id="newUser"></div>

<div id="updateUser"></div>

<div id="deleteUser"></div>

<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeModal">&times; Odpověď ze serveru:</span>
        <p id="modalMessage"></p>
    </div>
</div>

</body>

</html>